{
    "@context": [
        "https://www.w3.org/ns/activitystreams"
    ],
    "to": ["https://www.w3.org/ns/activitystreams#Public"],
    "name": "Server Tool",
    "type": "Article","content": "\u003ch1 id=\"server-tool\"\u003eServer Tool\u003c/h1\u003e\n\u003ch2 id=\"用-bash-寫-log-分析工具\"\u003e用 bash 寫 log 分析工具\u003c/h2\u003e\n\u003cp\u003e因為我們的 server 不知道是為什麼一直受到 DDoS 攻擊\u003cbr\u003e\n我想知道是什麼時段容易受到攻擊和每次多久、來自那個 ip\u003cbr\u003e\n於是我花了一點時間寫了幾個簡單的 script\u003c/p\u003e\n\u003chr\u003e\n\u003ch3 id=\"先來講我遇到的坑好了\"\u003e先來講我遇到的坑好了\u003c/h3\u003e\n\u003ch4 id=\"sh\"\u003esh\u003c/h4\u003e\n\u003cp\u003e過程中遇到一個最大的坑是在 ubuntu 預設的 sh 不是 bash\n是 dash\n據說比較情輕薄\u003cbr\u003e\n我在試 bash 中數字的運算比較時踩到這個坑\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e8\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003ea\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eb\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e6\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e((\u003c/span\u003e a \u0026gt; b \u003cspan class=\"o\"\u003e))\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e yes\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e no\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e因為我在試語法是否正確\n開了一個新的檔案\n我懶的 \u003ccode\u003echmod\u003c/code\u003e 直接 \u003ccode\u003esh tt.sh\u003c/code\u003e\n結果 \u003ccode\u003esh\u003c/code\u003e 是 dash\ndash 沒有支援這個語法\n然後抓了快 20 分鐘的 bug\n還是乖乖寫 \u003ccode\u003e#!/bin/bash\u003c/code\u003e 吧\u003c/p\u003e\n\u003ch4 id=\"floating-point-number\"\u003efloating point number\u003c/h4\u003e\n\u003cp\u003e我的 script 中有用浮點數的除法\n但是 bash 只支援整數\n所以除出來都是 0\n這個坑沒有很大\n很容易解決\n只要使用 \u003ccode\u003ebc\u003c/code\u003e 這個指令就可以了\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e$ bc -l \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;100/3\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e33.33333333333333333333\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch4 id=\"associate-array\"\u003eAssociate array\u003c/h4\u003e\n\u003cp\u003e在有一個地方本來要用關聯式陣列來存一些資料\n在定義關聯是陣列要把 \u003ccode\u003e-a\u003c/code\u003e 改成 \u003ccode\u003e-A\u003c/code\u003e\n這邊遇到什麼問題有點忘記了\n想到再補起來\n反正最後沒有用關聯式陣列\u003c/p\u003e\n\u003chr\u003e\n\u003ch3 id=\"其他\"\u003e其他\u003c/h3\u003e\n\u003ch4 id=\"程式碼\"\u003e程式碼\u003c/h4\u003e\n\u003cp\u003e\u003ca class=\"link\" href=\"https://github.com/simba-fs/server-tool\"  target=\"_blank\" rel=\"noopener\"\n    \u003ehttps://github.com/simba-fs/server-tool\u003c/a\u003e\n介紹：\u003c/p\u003e\n\u003ch4 id=\"barsh\"\u003ebar.sh\u003c/h4\u003e\n\u003cp\u003eDraw a bar from data\u003c/p\u003e\n\u003ch4 id=\"countsh\"\u003ecount.sh\u003c/h4\u003e\n\u003cp\u003eCount how many times does each line appear in file\u003c/p\u003e\n\u003ch4 id=\"ipsh\"\u003eip.sh\u003c/h4\u003e\n\u003cp\u003eCount how many times does each ip send a request\u003c/p\u003e\n\u003ch4 id=\"timesh\"\u003etime.sh\u003c/h4\u003e\n\u003cp\u003eCount how many request in each secend/minute/hour/day\u003c/p\u003e\n\u003ch4 id=\"好站連結\"\u003e好站連結\u003c/h4\u003e\n\u003cp\u003e\u003ca class=\"link\" href=\"https://www.regextester.com/\"  target=\"_blank\" rel=\"noopener\"\n    \u003ehttps://www.regextester.com/\u003c/a\u003e\n這個網站可以測試 RegEx\n蠻不錯的\u003c/p\u003e\n","mediaType": "text/html",
    "published": "2020-02-16T00:00:00+00:00",
    "updated": "2020-02-16T00:00:00+00:00",
    "id": "https://blog.simbafs.cc/p/linux/server/server-tool/",
    "url": "https://blog.simbafs.cc/p/linux/server/server-tool/",
    "attributedTo": "https://blog.simbafs.cc"
}