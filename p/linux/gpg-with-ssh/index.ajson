{
    "@context": [
        "https://www.w3.org/ns/activitystreams"
    ],
    "to": ["https://www.w3.org/ns/activitystreams#Public"],
    "name": "GPG with SSH",
    "type": "Article","content": "\u003ch1 id=\"gpg-with-ssh\"\u003eGPG with SSH\u003c/h1\u003e\n\u003cp\u003e接續前一篇 \u003ca class=\"link\" href=\"/posts/linux/gpg/\" \u003egpg 的文章\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"指紋-fingerprint\"\u003e指紋 Fingerprint\u003c/h2\u003e\n\u003cp\u003e根據 \u003ca class=\"link\" href=\"https://help.gnome.org/users/seahorse/stable/misc-key-fingerprint.html.en\"  target=\"_blank\" rel=\"noopener\"\n    \u003eGNOME help\u003c/a\u003e 的說明，不同金鑰的指紋必然不同，因此如果要驗證、查詢的話，與其用其他參數，不如用指紋，例如我的 GPG key 指紋是 \u003ccode\u003e6236 A070 8FCD 894C 7AD1 A5FC DB13 A5C2 042E AEA4\u003c/code\u003e，看到這串就代表是我。\u003c/p\u003e\n\u003ch2 id=\"grip\"\u003eGrip\u003c/h2\u003e\n\u003cp\u003e根據 \u003ca class=\"link\" href=\"https://lists.gnupg.org/pipermail/gcrypt-devel/2013-June/002205.html\"  target=\"_blank\" rel=\"noopener\"\n    \u003egnupg 的這封郵件\u003c/a\u003e，grip 似乎是金鑰參數的 SHA-1 hash，看不太懂哪些參數會被納入計算。\u003c/p\u003e\n\u003ch2 id=\"ssh-authorize-with-gpg\"\u003essh authorize with gpg\u003c/h2\u003e\n\u003cp\u003e以下步驟來自下面三個參考網址\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca class=\"link\" href=\"https://blog.theerrorlog.com/using-gpg-zh.html\"  target=\"_blank\" rel=\"noopener\"\n    \u003ehttps://blog.theerrorlog.com/using-gpg-zh.html\u003c/a\u003e (這裡有一些關於 gpg 的設定操做，不一定要像他說的那樣主密鑰分離，只是給一個操作說明)\u003c/li\u003e\n\u003cli\u003e\u003ca class=\"link\" href=\"https://blog.theerrorlog.com/using-gpg-keys-for-ssh-authentication-zh.html\"  target=\"_blank\" rel=\"noopener\"\n    \u003ehttps://blog.theerrorlog.com/using-gpg-keys-for-ssh-authentication-zh.html\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca class=\"link\" href=\"https://gist.github.com/mcattarinussi/834fc4b641ff4572018d0c665e5a94d3\"  target=\"_blank\" rel=\"noopener\"\n    \u003ehttps://gist.github.com/mcattarinussi/834fc4b641ff4572018d0c665e5a94d3\u003c/a\u003e (gpg-agent 設定看這篇，這前面有非常詳細的 gpg ket 設定教學)\u003c/li\u003e\n\u003c/ul\u003e\n\u003col\u003e\n\u003cli\u003e根據第二個參考資料的說明產生可以用於 ssh 驗證的 gpg subkey（有\u003ccode\u003e[A]\u003c/code\u003e）\u003c/li\u003e\n\u003cli\u003e取得 ssh 格式的公鑰 \u003ccode\u003egpg2 --export-ssh-key you@example.com\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e取得要用於驗證的 subkey 的 keygrip\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-fallback\" data-lang=\"fallback\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e$ gpg2 --list-keys --with-keygrip\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/home/you/.gnupg/pubring.kbx\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e------------------------------\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003epub   rsa4096 2022-12-06 [C]\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      Keygrip = BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003euid           [ultimate] you \u0026lt;you@example.com\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esub   rsa4096 2022-12-06 [S]\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      Keygrip = CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esub   rsa4096 2022-12-06 [E]\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      Keygrip = DDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDD\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esub   ed25519 2022-12-06 [A] \u0026lt;- 可用於驗證的子金鑰\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      Keygrip = EEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE \u0026lt;- 我們要的 keygrip\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003col start=\"4\"\u003e\n\u003cli\u003e將 keygrip 寫入 \u003ccode\u003e.gnupg/sshcontrol\u003c/code\u003e -\u0026gt; \u003ccode\u003eecho EEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE \u0026gt;\u0026gt; .gnupg/sshcontrol\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e根據第三個參考網址 \u003ca class=\"link\" href=\"https://gist.github.com/mcattarinussi/834fc4b641ff4572018d0c665e5a94d3#setup-the-gpg-agent-for-ssh-authentication\"  target=\"_blank\" rel=\"noopener\"\n    \u003esetup-the-gpg-agent-for-ssh-authentication\u003c/a\u003e 章節設定 gpg-agent\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e這時後重新開啟終端機就可以用 gpg 取代原本的 ssh key 了，確認移除 ssh key 真的還可以登入後就可以把舊的 ssh key 收起來了。\u003c/p\u003e\n","mediaType": "text/html",
    "published": "2022-12-06T00:00:00+00:00",
    "updated": "2022-12-06T00:00:00+00:00",
    "id": "https://blog.simbafs.cc/p/linux/gpg-with-ssh/",
    "url": "https://blog.simbafs.cc/p/linux/gpg-with-ssh/",
    "attributedTo": "https://blog.simbafs.cc"
}