<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="IPFS ipfs（InterPlanetary File System）是一個去中心化的檔案儲存方案，為什麼說是方案，因為他包括了通訊協議、軟體、檔案系統、"><title>IPFS</title><link rel=canonical href=https://blog.simbafs.cc/p/ipfs/><link rel=stylesheet href=/scss/style.min.8191399262444ab68b72a18c97392f5349be20a1615d77445be51e974c144cff.css><meta property="og:title" content="IPFS"><meta property="og:description" content="IPFS ipfs（InterPlanetary File System）是一個去中心化的檔案儲存方案，為什麼說是方案，因為他包括了通訊協議、軟體、檔案系統、"><meta property="og:url" content="https://blog.simbafs.cc/p/ipfs/"><meta property="og:site_name" content="Simba 的喵窩"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="web3"><meta property="article:tag" content="decentralized"><meta property="article:published_time" content="2022-08-22T16:44:06+08:00"><meta property="article:modified_time" content="2022-08-22T16:44:06+08:00"><meta name=twitter:site content="@simbafs"><meta name=twitter:creator content="@simbafs"><meta name=twitter:title content="IPFS"><meta name=twitter:description content="IPFS ipfs（InterPlanetary File System）是一個去中心化的檔案儲存方案，為什麼說是方案，因為他包括了通訊協議、軟體、檔案系統、"></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"dark")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切換選單>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hua1d55c26052b345e2b49223d0087ef3a_89734_300x0_resize_box_3.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a>
<span class=emoji>💤</span></figure><div class=site-meta><h1 class=site-name><a href=/>Simba 的喵窩</a></h1><h2 class=site-description>雜七雜八的東西</h2></div></header><ol class=social-menu><li><a href=https://github.com/simbafs target=_blank title=GitHub rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=/index.xml target=_blank title=RSS rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-rss" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="5" cy="19" r="1"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg></a></li><li><a href=https://twitter.com/simbafs target=_blank title=Twitter rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/about/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>About</span></a></li><li><a href=/links/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg><span>Links</span></a></li><li><a href=/resource/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg><span>Resource</span></a></li><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>夜晚模式</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目錄</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#安裝>安裝</a></li><li><a href=#android>Android</a></li><li><a href=#基本功能>基本功能</a></li><li><a href=#ipfs-上傳檔案>ipfs 上傳檔案</a></li><li><a href=#下載檔案>下載檔案</a></li><li><a href=#查看自己的-id>查看自己的 id</a></li><li><a href=#查看-peers>查看 peers</a></li><li><a href=#wrap>wrap</a></li><li><a href=#可變位址>可變位址</a></li><li><a href=#ipns>IPNS</a><ol><li><a href=#publish>publish</a></li><li><a href=#republish>republish</a></li></ol></li><li><a href=#dnslink>DNSLink</a><ol><li><a href=#ipns-in-dnslink>ipns in DNSLink</a></li></ol></li><li><a href=#瀏覽器>瀏覽器</a></li><li><a href=#gateway-閘道器>Gateway 閘道器</a></li><li><a href=#使用閘道器>使用閘道器</a></li><li><a href=#本機閘道器>本機閘道器</a><ol><li><a href=#cid-in-subdomain>CID in subdomain</a></li></ol></li><li><a href=#架一個看起來很像正常但其實是放在-ipfs-的網頁>架一個看起來很像正常但其實是放在 ipfs 的網頁</a></li><li><a href=#心得>心得</a></li><li><a href=#如何獎勵強迫做種節點中心化問題>如何獎勵/強迫做種（節點中心化問題）</a></li><li><a href=#閘道器中心化問題>閘道器中心化問題</a></li><li><a href=#參考資料>參考資料</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/web3/>web3</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/ipfs/>IPFS</a></h2></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>2022/08/22</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>閱讀時間: 9 分鐘</time></div></footer></div></header><section class=article-content><h1 id=ipfs>IPFS</h1><p>ipfs（<strong>I</strong>nter<strong>P</strong>lanetary <strong>F</strong>ile <strong>S</strong>ystem）是一個去中心化的檔案儲存方案，為什麼說是方案，因為他包括了通訊協議、軟體、檔案系統、名稱系統、閘道器。這個概念其實不新鮮但是 ipfs 整合過去去中心化方案的優點，而且他整合很很棒，可以開箱即用（out of box）。在 <a class=link href=https://github.com/ipfs/kubo/#what-is-ipfs target=_blank rel=noopener>ipfs 的 GitHub README.md 中</a> 中的介紹：「It is like a single BitTorrent swarm, exchanging git objects」。他傳檔案的方式就像 BT 一樣是透過 p2p，定位檔案的方式像 Git，將檔案內容雜湊。</p><hr><h2 id=安裝>安裝</h2><p>截稿當下，ipfs 還沒有被 Ubuntu 收錄，所以你沒辦法用 <code>apt install</code> 安裝。ipfs 的執行擋是用 Go 寫的，因此可以輕易跨平台執行，去 <a class=link href=https://github.com/ipfs/kubo/releases/latest target=_blank rel=noopener>ipfs 在 GitHub 的 Release 頁面</a> 下載對應的版本，然後解壓縮，你可以把 <code>ipfs</code> 這個檔案自己搬到你的 <code>$PATH</code> 下，或是用 <code>$ ./install.sh</code> 讓他的安裝腳本幫你選擇目錄</p><h2 id=android>Android</h2><p>在 Google play 可以找到一堆號稱是 ipfs 的 App，但功能都不齊全，如果你想在在 Android 手機上執行 ipfs，最好的方式是用 <a class=link href=https://termux.dev/en/ target=_blank rel=noopener>termux</a> 這套終端機模擬器，現在 Google Play 上已經沒有更新，要最新版的要去 <a class=link href=https://github.com/termux/termux-app#f-droid target=_blank rel=noopener>F-Droid</a> 或是 <a class=link href=https://github.com/termux/termux-app/releases/latest target=_blank rel=noopener>GitHub Release</a> 下載。安裝後一樣按照上面的步驟，檔案選 <code>linux-arm64</code> 那個就可以了。經過測試所有功能都和電腦一樣，包括 webui。</p><h2 id=基本功能>基本功能</h2><h2 id=ipfs-上傳檔案>ipfs 上傳檔案</h2><p>在節點 A 上執行 <code>$ ipfs add &lt;file></code>、<code>$ cat &lt;file> | ipfs add</code>，這個命令會回傳一串 hash，稱為 <code>CID</code>，通常是 <code>Qm</code> 開頭，所以也被稱為 Qm hash</p><h2 id=下載檔案>下載檔案</h2><p>如果另一個節點有任何方式可以連線到節點 A（不論是直接的 peer 或是透過全球、區域的網路連接）都可以用 <code>$ ipfs cat &lt;CID></code> 將內容印到 stdout。如果要直接存起來，也可以用 <code>$ ipfs get [-o file] &lt;CID></code>，如果不指定 <code>-o</code> 檔名會是 CID</p><h2 id=查看自己的-id>查看自己的 id</h2><p><code>$ ipfs id | jq .ID</code></p><h2 id=查看-peers>查看 peers</h2><p>這個指令會列出所有直接連線節點的 id，如果找不到不代表拿不到檔案，透過間接的方式還是拿得到，只是第一次要找比較久
<code>$ ipfs swarm peers</code></p><h2 id=wrap>wrap</h2><p>如果一次有多個檔案要分享，例如一個網站，可以用 <code>-w</code> <strong>保留目錄結構</strong>，例如以下目錄</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>├── favicon.ico
</span></span><span class=line><span class=cl>├── index.html
</span></span><span class=line><span class=cl>└── script.js
</span></span></code></pre></td></tr></table></div></div><p>用指令 <code>$ ipfs add -w *</code>，可以將這些檔案包在一個 CID 下（當然每個檔案也都有各自的 CID），以下是執行後的輸出</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>added QmTkhTu5EmX4qzPX4epFZr99WuWfPf8KTcCqySqf7tyH3z favicon.ico
</span></span><span class=line><span class=cl>added QmeBWHaefLwKkn7TgGdzyxgtaTTRkPeM3X4RbUY4xr736c index.html
</span></span><span class=line><span class=cl>added QmchNhX1C1SgWJK4eZHar1v92ck4BsoVmVriBHN1r4KWRs script.js
</span></span><span class=line><span class=cl>added QmS1byYBM16thyGbJtjnMYz32E9eMxfXdzbA4VAKR8nTch 
</span></span></code></pre></td></tr></table></div></div><p>最下面那個就是包起來的 CID。原本要取得 <code>index.html</code> 需要用 <code>ipfs cat QmeBWHaefLwKkn7TgGdzyxgtaTTRkPeM3X4RbUY4xr736c</code>，但如果用 wrap 就可以改成 <code>ipfs cat QmS1byYBM16thyGbJtjnMYz32E9eMxfXdzbA4VAKR8nTch/index.html</code>。這樣做的好處是即使有多個檔案，也只需要記一個 CID，像是我們可以用同一個 CID 取得 <code>script.js</code> <code>ipfs cat QmS1byYBM16thyGbJtjnMYz32E9eMxfXdzbA4VAKR8nTch/script.js</code></p><blockquote><p><strong>Notice</strong><br><code>QmS1byYBM16thyGbJtjnMYz32E9eMxfXdzbA4VAKR8nTch</code> 這個 CID 代表的是一個「目錄」，所以他不能用 <code>$ ipfs cat &lt;CID></code>，這時候要改用 <code>$ ipfs ls &lt;CID></code></p></blockquote><blockquote><p><strong>Warning</strong><br>這個範例都是檔案，如果有目錄的話要加上選項 <code>-r</code></p></blockquote><blockquote><p><strong>Warning</strong><br>因為目錄也是根據內容雜湊，所以你不能修改目錄內的檔案而不變動目錄的 CID，就和檔案一樣</p></blockquote><h2 id=可變位址>可變位址</h2><h2 id=ipns>IPNS</h2><p>ipfs 有個介紹到這裡，有個小問題，一個檔案只要一更改，位址（CID）就會改變，這對於網路存取很不友善，誰知道那一大串 hash 要去哪裡找？因此 ipfs 提供了一個方案：IPNS</p><h3 id=publish>publish</h3><p>首先，我們先準備一個CID <code>QmZLRFWaz9Kypt2ACNMDzA5uzACDRiCqwdkNSP1UZsu56D</code>，他的內容就一個字「hi」。一樣 add 之後，就要來使用 ipns 了</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ ipfs name publish QmZLRFWaz9Kypt2ACNMDzA5uzACDRiCqwdkNSP1UZsu56D
</span></span></code></pre></td></tr></table></div></div><p>等個大概 30 秒之後，他會回傳類似這個</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Published to k51qzi5uqu5djj5l4icq7jgwc06bzhxjxpwo0ghpyf9h5pah5hr5i4se7sosnm: /ipfs/QmZLRFWaz9Kypt2ACNMDzA5uzACDRiCqwdkNSP1
</span></span></code></pre></td></tr></table></div></div><p>第一個 hash <code>k51......snm</code> 那個我們稱之為 <code>key</code>，現在就可以用 <code>/ipns/k51qzi5uqu5djj5l4icq7jgwc06bzhxjxpwo0ghpyf9h5pah5hr5i4se7sosnm</code> 來存取原本的 <code>/ipfs/QmZLRFWaz9Kypt2ACNMDzA5uzACDRiCqwdkNSP1</code> 了</p><blockquote><p><strong>Notice</strong><br><code>/ipfs/CID</code> 或是 <code>/ipns/&lt;key></code> 都可以想成 path，放在 <code>$ ipfs cat</code>、<code>$ ipfs ls</code> 後面當參數。或是可以透過公開的閘道器，例如 <a class=link href=ipfs.io>ipfs.io</a> 存取。<code>https://ipfs.io/ipfs/&lt;CID></code>、<code>https://ipfs.io/ipns/&lt;key></code></p></blockquote><h3 id=republish>republish</h3><p>我們還沒示範到 ipns 的重要功能：可變位址。現在準備另一個 CID <code>QmermPSVVcmcutmQ1woTAtUcByUvoS2F3ZcKdkdbuAdEi5</code>，內容是「hihi」</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ ipfs name publish -k k51qzi5uqu5djj5l4icq7jgwc06bzhxjxpwo0ghpyf9h5pah5hr5i4se7sosnm QmermPSVVcmcutmQ1woTAtUcByUvoS2F3ZcKdkdbuAdEi5
</span></span><span class=line><span class=cl>Published to k51qzi5uqu5djj5l4icq7jgwc06bzhxjxpwo0ghpyf9h5pah5hr5i4se7sosnm: /ipfs/QmermPSVVcmcutmQ1woTAtUcByUvoS2F3ZcKdkdbuAdEi5
</span></span></code></pre></td></tr></table></div></div><p>一樣等個 30 秒左右，原本 key 就指向新的內容「hihi」了</p><blockquote><p><strong>Notice</strong><br>你不用擔心有其他人會擅自幫你更新 key 的指向，因為那個 key 其實是一對非對稱金鑰的公鑰，私鑰存在你的電腦，只有有私鑰的人才能更新。</p></blockquote><h2 id=dnslink>DNSLink</h2><p>如果你覺得用非對稱金鑰產生的 key 很醜，還是記不住，你可以透過傳統的 DNS 來當作 key（意味著這部份其實是中心化的，要付錢）<br>DNSLink 的用法很簡單，假設你想要把 ipfs.simbafs.cc 當作 key 指向 CID <code>QmZLRFWaz9Kypt2ACNMDzA5uzACDRiCqwdkNSP1UZsu56D</code>，那就在 <code>_dnslink.ipfs.simbafs.cc</code> 新增一條 TXT DNS 紀錄 <code>dnslink=/ipfs/QmZLRFWaz9Kypt2ACNMDzA5uzACDRiCqwdkNSP1UZsu56D</code>，這時候你就可以用 <code>/ipns/ipfs.simbafs.cc</code> 來代替 <code>/ipfs/QmZLRFWaz9Kypt2ACNMDzA5uzACDRiCqwdkNSP1UZsu56D</code> 了<br>這時候你可以查 DNS 紀錄，如果正常就代表設定完成了</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ dig +short TXT _dnslink.ipfs.simbafs.cc
</span></span><span class=line><span class=cl>&#34;dnslink=dnslink=/ipfs/QmZLRFWaz9Kypt2ACNMDzA5uzACDRiCqwdkNSP1UZsu56D&#34;
</span></span></code></pre></td></tr></table></div></div><h3 id=ipns-in-dnslink>ipns in DNSLink</h3><p>如果你查看 ipfs.io 的 DNSLink 紀錄，你會發現他的內容是 <code>dnslink=/ipns/website.ipfs.io</code>，也就是說 <code>/ipns/ipfs.io</code> 和 <code>/ipns/website.ipfs.io</code> 是一樣的，從瀏覽器看起來也的確如此。再查 website 的 DNSLink 紀錄 <code>dnslink=/ipfs/QmQoprt2cVNJKrDUTg2QYHmaqw7T1E36sSg9bPiWgoLY48</code>，看來 ipfs.io 真正指向的 CID 其實是 <code>Qm....Y48</code><br>這個案例告訴我們，DNSLink 不一定只能放 CID，放 ipns 的 key 也是可以的，例如指向 <code>/ipns/k51qzi5uqu5djj5l4icq7jgwc06bzhxjxpwo0ghpyf9h5pah5hr5i4se7sosnm</code> 的話，只要更新 <code>k51qzi5uqu5djj5l4icq7jgwc06bzhxjxpwo0ghpyf9h5pah5hr5i4se7sosnm</code> 的指向內容就可以更新網站，不需要動 DNS 紀錄</p><blockquote><p><strong>Notice</strong><br>我測試有成功，至少更新 ipns 比更新 DNS 快，而且只需要在 CLI 操作</p></blockquote><hr><h2 id=瀏覽器>瀏覽器</h2><p>目前為止，所有的操作都在 CLI 中透過 <code>ipfs</code> 命令進行，但我們的目標應該是透過瀏覽器可以看到掛在 ipfs 上的網頁吧！這個部份只能說都還不甚理想，要嘛是回歸中心化的解決方案，不然就是網址會長很醜。</p><h2 id=gateway-閘道器>Gateway 閘道器</h2><p>之所以需要閘道器，就是因為瀏覽器還無法直接讀取 ipfs 的內容，所以需要閘道器幫忙做轉發，他的功能是把 location-based 的 http 轉換成 content-addressing 的 ipfs，再將資訊返回瀏覽器，例如將 ipfs.io 透過 ipns 解析成 <code>/ipfs/QmQoprt2cVNJKrDUTg2QYHmaqw7T1E36sSg9bPiWgoLY48</code>，取得內容後再將資料丟回給瀏覽器</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>                                                               ┌───────────┐
</span></span><span class=line><span class=cl>                                                               │           │
</span></span><span class=line><span class=cl>                                                      ┌──────► │ ipfs node │
</span></span><span class=line><span class=cl>                                                      │        │           │
</span></span><span class=line><span class=cl>                                                      │        └───────────┘
</span></span><span class=line><span class=cl>                                                      │
</span></span><span class=line><span class=cl>┌─────────────────┐            ┌──────────────┐       │        ┌───────────┐
</span></span><span class=line><span class=cl>│                 │            │              │  ipfs │ peers  │           │
</span></span><span class=line><span class=cl>│ Browser         │    http    │ ipfs gateway │ ◄─────┼──────► │ ipfs node │
</span></span><span class=line><span class=cl>│ https://ipfs.io │ ◄────────► │              │       │        │           │
</span></span><span class=line><span class=cl>│                 │            │              │       │        └───────────┘
</span></span><span class=line><span class=cl>└─────────────────┘            └──────────────┘       │
</span></span><span class=line><span class=cl>                                                      │        ┌───────────┐
</span></span><span class=line><span class=cl>                                                      │        │           │
</span></span><span class=line><span class=cl>                                                      └──────► │ ipfs node │
</span></span><span class=line><span class=cl>                                                               │           │
</span></span><span class=line><span class=cl>                                                               └───────────┘
</span></span></code></pre></td></tr></table></div></div><h2 id=使用閘道器>使用閘道器</h2><p>先整理一下我們現在有的東西</p><div class=table-wrapper><table><thead><tr><th style=text-align:center>key</th><th style=text-align:left>value</th></tr></thead><tbody><tr><td style=text-align:center>CID</td><td style=text-align:left><code>/ipfs/QmermPSVVcmcutmQ1woTAtUcByUvoS2F3ZcKdkdbuAdEi5</code></td></tr><tr><td style=text-align:center>ipns key</td><td style=text-align:left><code>/ipns/k51qzi5uqu5djj5l4icq7jgwc06bzhxjxpwo0ghpyf9h5pah5hr5i4se7sosnm</code></td></tr><tr><td style=text-align:center>DNSLink</td><td style=text-align:left><code>ipfs.simbafs.cc</code></td></tr><tr><td style=text-align:center>閘道器</td><td style=text-align:left>ipfs.io</td></tr></tbody></table></div><blockquote><p><strong>Notice</strong><br>閘道器有很多，我們用 ipfs 官方提供的來做示範，這裡有 <a class=link href=https://ipfs.github.io/public-gateway-checker/ target=_blank rel=noopener>公共閘道器列表</a>，下面會示範在本機架閘道器</p></blockquote><p>以下三個方式，都可以在瀏覽器中取得我們的檔案</p><ul><li>ipfs.io/ipfs/QmermPSVVcmcutmQ1woTAtUcByUvoS2F3ZcKdkdbuAdEi5</li><li>ipfs.io/ipns/k51qzi5uqu5djj5l4icq7jgwc06bzhxjxpwo0ghpyf9h5pah5hr5i4se7sosnm</li><li>ipfs.io/ipns/ipfs.simbafs.cc</li></ul><h2 id=本機閘道器>本機閘道器</h2><p>已經有公共閘道器了，為什麼還需要本機閘道器呢？因為公共閘道器，說到底還是一個中心化的設施，如果我們希望整個過程都是去中心化，那就要用本機的閘道器。而且如果你的檔案是放在本機，那用本機閘道器會最快找到，因為距離最近嘛，而且用本機閘道器還有加速網頁載入的效果，類似 cache。<br>使用本機閘道器很簡單，開啟 ipfs daemon 時就已經預設開一個本機閘道器了，位址在 localhost:8080，接著來看看怎樣可以連上我們的檔案</p><p>首先是和公共閘道器一樣的功能</p><ul><li>localhost:8080/ipfs/QmermPSVVcmcutmQ1woTAtUcByUvoS2F3ZcKdkdbuAdEi5</li><li>localhost:8080/ipns/k51qzi5uqu5djj5l4icq7jgwc06bzhxjxpwo0ghpyf9h5pah5hr5i4se7sosnm</li><li>localhost:8080/ipfs.io/ipns/ipfs.simbafs.cc</li></ul><p>然後是某些公共閘道器沒有開放的功能</p><ul><li>ipfs.simbafs.cc.ipns.localhost:8080</li><li>k51qzi5uqu5djj5l4icq7jgwc06bzhxjxpwo0ghpyf9h5pah5hr5i4se7sosnm.ipns.localhost:8080</li></ul><blockquote><h3 id=cid-in-subdomain>CID in subdomain</h3><p>插播一下，看到這裡，你會發現 DNSLink、ipns key 都可以放在閘道器的 subdomain，那為什麼 CID 不行呢？其實不是不行，但是需要小修改一下，因為我們的 CID 是區分大小寫的（case-sensitive），但是 domain name 是不區分大小寫的（case-insensitive，也就是說 google.com = Google.com = GoOglE.cOm），所以我們需要換一個 case-insensitive 的雜湊。<br><code>--cid-version 1</code> 這個選項會預設的 CIDv0 改成 CIDv1，CIDv1 會產生 case-insensitive 的雜湊。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ ipfs add --cid-version 1 hihi
</span></span><span class=line><span class=cl>added bafkreihkkkuu4u6n6tpxz7zpveva2toxahi5jprgxwvthvcoeefh36bcxy hihi
</span></span></code></pre></td></tr></table></div></div></blockquote><p>回到閘道器，慎選閘道器大概是比你的檔案怎麼丟上 ipfs 還重要的事，不只是因為閘道器的選擇會影響載入速度，更是因為閘道器代理了你的網頁，所以他可以修改、或是監控網頁的活動，再加上瀏覽器同源政策的影響，如果閘道器上有人要做壞事，那網站的資安可能就會受到威脅。但這方面我沒有研究，我知道可以避免的方式是不要用閘道器預設的網址，可以用 CNAME 改成自己的 domain，再來是選擇信任的閘道器，像是 ipfs.io、cf-ipfs.com 等等。當然如果是用自己的閘道器或是本機閘道器就更好了（但可能就要犧牲效能或是網址會變醜）。</p><h2 id=架一個看起來很像正常但其實是放在-ipfs-的網頁>架一個看起來很像正常但其實是放在 ipfs 的網頁</h2><p>研究中&mldr;https 搞不定<br>gateway timeout&mldr;</p><hr><h2 id=心得>心得</h2><p>ipfs 是真的有潛力改變網路生態的，但是他還有兩大問題要解決，一是如何獎勵/強迫做種（借用 BT 的名詞 XD），也就是節點中心化問題，二是閘道器中心化問題，兩個都解決了或許 ipfs 就可以真正的實現</p><h2 id=如何獎勵強迫做種節點中心化問題>如何獎勵/強迫做種（節點中心化問題）</h2><p>這個問題和 BT 一樣，假設今天我一個無名小卒想要在 ipfs 發布一個檔案，很顯然我自己開一個節點最簡單方便，但是如果我的檔案瀏覽人數不多，就會變成只有我自己和少數的節點存資料，那存取速度會慢到靠北。要解決這個問題，就會產生出像是 cloudflare 這種 CDN 幫忙「快取」（以 ipfs 的術語來說應該就是「做種」）的服務，甚至是要付費的。最後就變成要發布檔案就要找這些 CDN 付費，不然他們的伺服器就不會存你的檔案，每次都要滿世界找到你的節點，才能要到資料。<br>當然，因為 ipfs 的天生設計關係，這個問題比傳統的 http 來說容易解決，畢竟總是會有其他小節點幫忙做種，但這還是一個值得關心的問題。<br>開發 ipfs 的 protocal lab 曾經提出一個方案來把做種的成本轉移，那就是發行 <a class=link href=https://en.wikipedia.org/wiki/Filecoin target=_blank rel=noopener>FileCoin</a>，但是以目前的市場來看，任何加密貨幣都會被拿去炒作，然後高機率爆掉，看下圖的 FileCoin 走勢就知道他被炒過一遍了</p><blockquote><p><img src=/filecoin.png loading=lazy alt=filecoin>
<a class=link href=https://crypto.com/price/zh-TW/filecoin target=_blank rel=noopener>source: https://crypto.com/price/zh-TW/filecoin</a></p></blockquote><p>這樣的機制能不能讓更多人願意做種？很難說</p><h2 id=閘道器中心化問題>閘道器中心化問題</h2><p>如果節點中心化無法解決，至少我覺得閘道器中心化是容易解決的，只要瀏覽器內嵌 ipfs 就好了，或是像當年 Adobe Flash 一樣要裝外掛（也就是類似現在的本地閘道器作法），而且當這東西變成標配之後做種的問題也順帶解決</p><h2 id=參考資料>參考資料</h2><p><a class=link href=https://docs.ipfs.tech target=_blank rel=noopener>ipfs docs</a></p></section><footer class=article-footer><section class=article-tags><a href=/tags/web3/>web3</a>
<a href=/tags/decentralized/>decentralized</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.css integrity="sha256-J+iAE0sgH8QSz9hpcDxXIftnj65JEZgNhGcgReTTK9s=" crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.js integrity="sha256-InsNdER1b2xUewP+pKCUJpkhiqwHgqiPXDlIk7GzBu4=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/auto-render.min.js integrity="sha256-y39Mpg7V3D4lhBX4x6O0bUqTV4pSrfgwEfGKfxkOdgI=" crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.querySelector(`.article-content`),{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})})</script></article><footer class=site-footer><section class=copyright>&copy;
2020 -
2023 Simba 的喵窩</section><section class=powerby>好想養貓阿~~<br>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.16.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>